{
    "version": "https://jsonfeed.org/version/1",
    "title": "Funkynoob的个人博客 • All posts by \"mybatis\" tag",
    "description": "亿点点心得",
    "home_page_url": "https://blog.riversea.top",
    "items": [
        {
            "id": "https://blog.riversea.top/2024/01/28/mybatis/",
            "url": "https://blog.riversea.top/2024/01/28/mybatis/",
            "title": "MyBatis",
            "date_published": "2024-01-28T07:12:54.000Z",
            "content_html": "<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"getting-started\"><a class=\"markdownIt-Anchor\" href=\"#getting-started\">#</a> Getting Started</h1>\n<h2 id=\"所需依赖\"><a class=\"markdownIt-Anchor\" href=\"#所需依赖\">#</a> 所需依赖</h2>\n<p><code>MyBatis</code>  依赖：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mybatis<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mybatis<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>x.x.x<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>数据库驱动：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.mysql<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mysql-connector-j<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>x.x.x<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"配置文件\"><a class=\"markdownIt-Anchor\" href=\"#配置文件\">#</a> 配置文件</h2>\n<p><code>MyBatis</code>  中有两个 <code>XML</code>  配置文件。</p>\n<p><code>MyBatis</code>  的核心配置文件用于配置数据源等信息 ———— <code>Mybatis-config.xml</code> ：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-meta\">&lt;?xml version=<span class=\"hljs-string\">&quot;1.0&quot;</span> encoding=<span class=\"hljs-string\">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">configuration</span></span><br><span class=\"hljs-meta\">  <span class=\"hljs-keyword\">PUBLIC</span> <span class=\"hljs-string\">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class=\"hljs-meta\">  <span class=\"hljs-string\">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">environments</span> <span class=\"hljs-attr\">default</span>=<span class=\"hljs-string\">&quot;development&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">environment</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;development&quot;</span>&gt;</span><br>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">transactionManager</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;JDBC&quot;</span>/&gt;</span><br>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dataSource</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;POOLED&quot;</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;driver&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;url&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&quot;$&#123;url&#125;&quot;</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;username&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&quot;$&#123;username&#125;&quot;</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;password&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&quot;$&#123;password&#125;&quot;</span>/&gt;</span><br>      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dataSource</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">environment</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">environments</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mappers</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">resource</span>=<span class=\"hljs-string\">&quot;&quot;</span>/&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mappers</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p><code>MyBatis</code>  映射文件用于配置 <code>sql</code>  语句 ———— <code>xxxMmapper.xml</code> ：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-meta\">&lt;?xml version=<span class=\"hljs-string\">&quot;1.0&quot;</span> encoding=<span class=\"hljs-string\">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">mapper</span></span><br><span class=\"hljs-meta\">  <span class=\"hljs-keyword\">PUBLIC</span> <span class=\"hljs-string\">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class=\"hljs-meta\">  <span class=\"hljs-string\">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">namespace</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span><br>  <br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>[!Note]</p>\n<p>注意，上述配置文件的名字不是固定的，但一般取为 <code>Mybatis-config.xml</code>  和 <code>xxxMmapper.xml</code> 。</p>\n<p>放置的位置也不是固定的，但一般为 <code>resources</code>  下</p>\n</blockquote>\n<h2 id=\"建表\"><a class=\"markdownIt-Anchor\" href=\"#建表\">#</a> 建表</h2>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">create</span> <span class=\"hljs-keyword\">table</span> if <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">exists</span> t_user(<br>    id <span class=\"hljs-type\">bigint</span> <span class=\"hljs-keyword\">primary</span> key auto_increment comment <span class=\"hljs-string\">&#x27;主键自增&#x27;</span>,<br>    car_num <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>) comment <span class=\"hljs-string\">&#x27;汽车编号&#x27;</span>,<br>    brand <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>) comment <span class=\"hljs-string\">&#x27;品牌&#x27;</span>,<br>    guide_price <span class=\"hljs-type\">decimal</span> comment <span class=\"hljs-string\">&#x27;厂家指导价&#x27;</span>,<br>    produce_time <span class=\"hljs-type\">date</span> comment <span class=\"hljs-string\">&#x27;生产时间&#x27;</span>,<br>    car_type <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>) comment <span class=\"hljs-string\">&#x27;汽车类型&#x27;</span><br>);<br></code></pre></td></tr></table></figure>\n<h2 id=\"配置数据库\"><a class=\"markdownIt-Anchor\" href=\"#配置数据库\">#</a> 配置数据库</h2>\n<p>在核心配置文件中的 <code>&lt;datasource&gt;</code>  标签中的 <code>&lt;property&gt;</code>  标签，填入连接数据库的 <code>driver</code> 、 <code>url</code> 、 <code>username</code> 、 <code>password</code> 。</p>\n<hr>\n<p>或者在 <code>&lt;configuration&gt;</code>  中的开头填入以下内容：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">properties</span> <span class=\"hljs-attr\">resource</span>=<span class=\"hljs-string\">&quot;jdbc.properties&quot;</span>/&gt;</span> #此标签的作用是引入资源文件<br></code></pre></td></tr></table></figure>\n<p>随后在 <code>jdbc.properties</code>  中填入：</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs properties\"><span class=\"hljs-attr\">driver</span>=<span class=\"hljs-string\"></span><br><span class=\"hljs-attr\">url</span>=<span class=\"hljs-string\"></span><br><span class=\"hljs-attr\">username</span>=<span class=\"hljs-string\"></span><br><span class=\"hljs-attr\">password</span>=<span class=\"hljs-string\"></span><br></code></pre></td></tr></table></figure>\n<h2 id=\"连接核心配置文件和映射文件\"><a class=\"markdownIt-Anchor\" href=\"#连接核心配置文件和映射文件\">#</a> 连接核心配置文件和映射文件</h2>\n<p>当你创建好映射文件后，需要在核心配置文件申明你所创建的映射文件的位置。</p>\n<p>在 <code>&lt;mappers&gt;</code>  标签中中填入映射文件：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mappers</span>&gt;</span><br>   <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">resource</span>=<span class=\"hljs-string\">&quot;&quot;</span>/&gt;</span><br> <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mappers</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>[!Note]</p>\n<p><code>resource</code>  从项目根目录进行查询。</p>\n</blockquote>\n<h2 id=\"编写映射文件\"><a class=\"markdownIt-Anchor\" href=\"#编写映射文件\">#</a> 编写映射文件</h2>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-meta\">&lt;?xml version=<span class=\"hljs-string\">&quot;1.0&quot;</span> encoding=<span class=\"hljs-string\">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">mapper</span> <span class=\"hljs-keyword\">PUBLIC</span> <span class=\"hljs-string\">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class=\"hljs-string\">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">namespace</span>=<span class=\"hljs-string\">&quot;com.jhy.demo1.mapper.CarMapper&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">insert</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;insertCar&quot;</span>&gt;</span><br>        insert into t_car values(null,&#x27;1002&#x27;,&#x27;奔驰&#x27;,20.00,current_date(),&#x27;燃油车&#x27;);<br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">insert</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"如何连接数据库\"><a class=\"markdownIt-Anchor\" href=\"#如何连接数据库\">#</a> 如何连接数据库？</h2>\n<p><code>Mybatis</code>  通过 <code>SqlSession</code>  实例建立连接数据库的一次会话。通过会话，就可以操控数据库</p>\n<p><code>SqlSession</code>  实例通过 <code>SqlSessionFactory</code>  实例创建，而 <code>SqlSessionFactory</code>  实例通过 <code>SqlSessionBuilder</code>  实例创建。</p>\n<p>代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Test</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">startTest</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> IOException &#123;<br>    <span class=\"hljs-keyword\">try</span>(<span class=\"hljs-type\">InputStream</span> <span class=\"hljs-variable\">inputStream</span> <span class=\"hljs-operator\">=</span> Resources.getResourceAsStream(<span class=\"hljs-string\">&quot;mybatis-config.xml&quot;</span>))&#123;<br>        <span class=\"hljs-type\">SqlSessionFactoryBuilder</span> <span class=\"hljs-variable\">sqlSessionFactoryBuilder</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SqlSessionFactoryBuilder</span>();<br>        <span class=\"hljs-type\">SqlSessionFactory</span> <span class=\"hljs-variable\">sessionFactory</span> <span class=\"hljs-operator\">=</span> sqlSessionFactoryBuilder.build(inputStream);<br>        <span class=\"hljs-type\">SqlSession</span> <span class=\"hljs-variable\">sqlSession</span> <span class=\"hljs-operator\">=</span> sessionFactory.openSession();<br>        <span class=\"hljs-type\">CarMapper</span> <span class=\"hljs-variable\">carMapper</span> <span class=\"hljs-operator\">=</span> sqlSession.getMapper(CarMapper.class);<br>        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">res</span> <span class=\"hljs-operator\">=</span> carMapper.insertCar(); <span class=\"hljs-comment\">//insert，update，delete返回值是影响的行数</span><br>        System.out.println(<span class=\"hljs-string\">&quot;影响行数：&quot;</span> + res);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n<blockquote>\n<ul>\n<li><code>Resouces</code> ： <code>Mybatis</code>  提供的获取核心配置文件的类\n<ul>\n<li><code>Resources.getResourceAsStream()</code> ：将对应的配置文件封装为输入流，同样也是从项目根路径开始查找</li>\n</ul>\n</li>\n<li><code>sqlSessionFactoryBuilder.build(inputStream)</code> ：通过该配置文件创建出 <code>SqlSessionFactory</code>  实例</li>\n<li><code>sessionFactory.openSession()</code> ：生产 <code>SqlSession</code>  实例</li>\n</ul>\n</blockquote>\n<h2 id=\"执行sql语句\"><a class=\"markdownIt-Anchor\" href=\"#执行sql语句\">#</a> 执行 Sql 语句</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Test</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">startTest</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> IOException &#123;<br>    <span class=\"hljs-keyword\">try</span>(<span class=\"hljs-type\">InputStream</span> <span class=\"hljs-variable\">inputStream</span> <span class=\"hljs-operator\">=</span> Resources.getResourceAsStream(<span class=\"hljs-string\">&quot;mybatis-config.xml&quot;</span>))&#123;<br>        <span class=\"hljs-type\">SqlSessionFactoryBuilder</span> <span class=\"hljs-variable\">sqlSessionFactoryBuilder</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SqlSessionFactoryBuilder</span>();<br>        <span class=\"hljs-type\">SqlSessionFactory</span> <span class=\"hljs-variable\">sessionFactory</span> <span class=\"hljs-operator\">=</span> sqlSessionFactoryBuilder.build(inputStream);<br>        <span class=\"hljs-type\">SqlSession</span> <span class=\"hljs-variable\">sqlSession</span> <span class=\"hljs-operator\">=</span> sessionFactory.openSession();<br>        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">res</span> <span class=\"hljs-operator\">=</span> sqlSession.insert(<span class=\"hljs-string\">&quot;insertCar&quot;</span>) <span class=\"hljs-comment\">//insertCar为映射文件中insert块的id</span><br>        System.out.println(<span class=\"hljs-string\">&quot;影响行数：&quot;</span> + res);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>[!Important]</p>\n<p>运行上述代码，如果前面配置没有出错，则你会在控制台看见输出：影响行数：1</p>\n<p>但前往数据库并没有发现有记录的增加。</p>\n<p>因为 <code>Mybatis</code>  本身的事务是不会自动提交的。需要显式提交</p>\n</blockquote>\n<p>可以使用下面的语句显式提交</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">sqlSession.commit(); <span class=\"hljs-comment\">//提交事务</span><br></code></pre></td></tr></table></figure>\n<h1 id=\"获得输入流的几种方法\"><a class=\"markdownIt-Anchor\" href=\"#获得输入流的几种方法\">#</a> 获得输入流的几种方法</h1>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-type\">InputStream</span> <span class=\"hljs-variable\">inputStream</span> <span class=\"hljs-operator\">=</span> Resources.getResourceAsStream(<span class=\"hljs-string\">&quot;path/to/&quot;</span>)<br><span class=\"hljs-type\">InputStream</span> <span class=\"hljs-variable\">inputStream</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InputStream</span>(<span class=\"hljs-string\">&quot;path/to/&quot;</span>) <span class=\"hljs-comment\">//自己创建输入流，需要写明完整的绝对路径或者相对路径。</span><br><span class=\"hljs-type\">InputStream</span> <span class=\"hljs-variable\">is</span> <span class=\"hljs-operator\">=</span> ClassLoader.getSystemClassLoader().getResourceAsStream(<span class=\"hljs-string\">&quot;path/to/&quot;</span>); <span class=\"hljs-comment\">//Resources.getResourceAsStream()的底层实现</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>核心配置文件不一定放在项目根目录下，你可以在根目录下建个目录，也可以放在项目根目录外面</p>\n</blockquote>\n<h1 id=\"mybatis的事务管理\"><a class=\"markdownIt-Anchor\" href=\"#mybatis的事务管理\">#</a> Mybatis 的事务管理</h1>\n<p><code>Mybatis</code>  通过核心配置文件的 <code>&lt;transactionManager type=&quot;&quot;&gt;</code>  管理事务。</p>\n<p><code>type</code>  可用的属性为： <code>[JDBC|MANAGED]</code> 。不区分大小写</p>\n<ul>\n<li><code>JDBC</code> ： <code>Mybatis</code>  自己管理事务，使用 <code>JDBC</code>  原生的事务管理器进行管理。提交时，相当于 <code>JDBC</code>  的 <code>connection.commit()</code>\n<ul>\n<li>底层会创建 <code>JDBCTransaction</code>  实例</li>\n</ul>\n</li>\n<li><code>MANAGED</code> ： <code>Mybatis</code>  不自己管理事务，交给第三方框架，例如： <code>spring</code>\n<ul>\n<li>如果只有 <code>Mybatis</code>  本身，那么代表着不开启事务。</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>[!Important]</p>\n<p>JDBC 底层的事务是默认提交的。</p>\n</blockquote>\n<h2 id=\"源码分析\"><a class=\"markdownIt-Anchor\" href=\"#源码分析\">#</a> 源码分析</h2>\n<p>创建 <code>JDBC</code>  事务的 <code>SqlSession</code>  实例时，会创建 <code>JDBC</code>  原生的 <code>Connection</code>  实例。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-type\">SqlSession</span> <span class=\"hljs-variable\">sqlSession</span> <span class=\"hljs-operator\">=</span> sessionFactory.openSession(); <span class=\"hljs-comment\">//从这里打断点，进入openSession方法</span><br><br><span class=\"hljs-keyword\">return</span> openSessionFromDataSource(configuration.getDefaultExecutorType(), <span class=\"hljs-literal\">null</span>, <span class=\"hljs-literal\">false</span>); <span class=\"hljs-comment\">//openSession()的方法体，注意最后一个false</span><br><span class=\"hljs-comment\">/*进入openSessionFromDataSource()方法 一直执行至如下语句*/</span><br>tx = transactionFactory.newTransaction(environment.getDataSource(), level, autoCommit); <span class=\"hljs-comment\">//创建了一个事务，注意此时autoCommit为false</span><br><span class=\"hljs-comment\">//进入newTransaction()方法</span><br><span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">JdbcTransaction</span>(ds, level, autoCommit, skipSetAutoCommitOnClose);<br><br><span class=\"hljs-comment\">/*再次进入JdbcTransaction()方法，搜索openConnetion()方法，打上断点，执行至此</span><br><span class=\"hljs-comment\">一直运行至setDesiredAutoCommit()方法并进入*/</span><br><span class=\"hljs-keyword\">if</span> (connection.getAutoCommit() != desiredAutoCommit) &#123; <span class=\"hljs-comment\">//connection默认为自动提交，也就是autoCommit为true</span><br>    <span class=\"hljs-keyword\">if</span> (log.isDebugEnabled()) &#123;<br>        log.debug(<span class=\"hljs-string\">&quot;Setting autocommit to &quot;</span> + desiredAutoCommit + <span class=\"hljs-string\">&quot; on JDBC Connection [&quot;</span> + connection + <span class=\"hljs-string\">&quot;]&quot;</span>);<br>    &#125;<br>connection.setAutoCommit(desiredAutoCommit); <span class=\"hljs-comment\">//只有当autoCommit为false时才会执行，也就是将connection的自动提交关闭</span><br><br><span class=\"hljs-comment\">//如何开启自动提交？</span><br><span class=\"hljs-comment\">//最开始就将autoCommit设为true</span><br><span class=\"hljs-type\">SqlSession</span> <span class=\"hljs-variable\">sqlSession</span> <span class=\"hljs-operator\">=</span> sessionFactory.openSession(<span class=\"hljs-literal\">true</span>) <span class=\"hljs-comment\">//表示没有事务，执行一次DML就提交一次，不建议</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>[!Note]</p>\n<p>注意， <code>openSession()</code>  方法有三个重载：</p>\n<p><code>public SqlSession openSession()</code> ：默认 <code>autoCommit</code>  就为 <code>false</code></p>\n<p><code>public SqlSession openSession(boolean autoCommit)</code></p>\n<p><code>public SqlSession openSession(ExecutorType execType)</code></p>\n</blockquote>\n<p>创建 <code>MANAGED</code>  事务的 <code>SqlSession</code>  实例时</p>\n<h1 id=\"日志\"><a class=\"markdownIt-Anchor\" href=\"#日志\">#</a> 日志</h1>\n<p><code>Mybatis</code>  可用的日志框架：</p>\n<p>SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING |</p>\n<p><code>Mybatis</code>  本身实现了 <code>STDOUT_LOGGING</code> 。</p>\n<p>在 <code>&lt;settings&gt;</code>  中填入如下内容启用 <code>Mybatis</code>  自身的日志：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"> <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">settings</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">setting</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;logImpl&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&quot;STDOUT_LOGGING&quot;</span>/&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">settings</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p><code>&lt;settings&gt;</code>  应该在 <code>&lt;properties&gt;</code>  标签后</p>\n</blockquote>\n<h1 id=\"增删改查\"><a class=\"markdownIt-Anchor\" href=\"#增删改查\">#</a> 增删改查</h1>\n<ul>\n<li>通过 <code>#&#123;&#125;</code>  来提供传入的参数。 <code>&#123;&#125;</code>  中填入传值的参数</li>\n</ul>\n<p>仍然使用 [Getting Started](#Getting Started) 中使用的表，代码</p>\n<h2 id=\"增\"><a class=\"markdownIt-Anchor\" href=\"#增\">#</a> 增</h2>\n<p>将映射语句改成如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">insert</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;insertCar&quot;</span>&gt;</span><br>    insert into t_car values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;);<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"map\"><a class=\"markdownIt-Anchor\" href=\"#map\">#</a> Map</h3>\n<p>通过 <code>map</code>  传参，代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-type\">SqlSession</span> <span class=\"hljs-variable\">sqlSession</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;<br><span class=\"hljs-keyword\">try</span>&#123;<br>    sqlSession = SqlSessionUtil.getSqlSession();<br>    Map&lt;String,Object&gt; map = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();<br>    map.put(<span class=\"hljs-string\">&quot;id&quot;</span>,<span class=\"hljs-literal\">null</span>);<br>    map.put(<span class=\"hljs-string\">&quot;carNum&quot;</span>,<span class=\"hljs-string\">&quot;1003&quot;</span>);<br>    map.put(<span class=\"hljs-string\">&quot;brand&quot;</span>,<span class=\"hljs-string\">&quot;大众&quot;</span>);<br>    map.put(<span class=\"hljs-string\">&quot;guidePrice&quot;</span>,<span class=\"hljs-number\">10.00</span>);<br>    map.put(<span class=\"hljs-string\">&quot;produceTime&quot;</span>, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Date</span>());<br>    map.put(<span class=\"hljs-string\">&quot;carType&quot;</span>,<span class=\"hljs-string\">&quot;老爷车&quot;</span>);<br>    System.out.println(<span class=\"hljs-string\">&quot;影响: &quot;</span> + sqlSession.insert(<span class=\"hljs-string\">&quot;insertCar&quot;</span>, map));<br>    sqlSession.commit();<br>&#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>    <span class=\"hljs-keyword\">if</span>(sqlSession != <span class=\"hljs-literal\">null</span>)&#123;<br>        sqlSession.rollback();<br>        sqlSession.close();<br>    &#125;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure>\n<h3 id=\"实体类\"><a class=\"markdownIt-Anchor\" href=\"#实体类\">#</a> 实体类</h3>\n<p>创建一个 <code>Car</code>  实体类：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Car</span> &#123;<br>    Integer id;<br>    String carNum;<br>    String brand;<br>    BigDecimal guidPrice;<br>    Date produceTime;<br>    String carType;<br>&#125;<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>@Data 为 <code>lombok</code>  依赖的注解，用于简化实体类开发，自动创建 <code>getter</code> 、 <code>setter</code>  方法以及重写 <code>toString</code>  方法</p>\n<p>@AllArgsConstructor 则是创建全参数的构造器</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-type\">SqlSession</span> <span class=\"hljs-variable\">sqlSession</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;<br><span class=\"hljs-keyword\">try</span>&#123;<br>    sqlSession = SqlSessionUtil.getSqlSession();<br>    <span class=\"hljs-type\">Car</span> <span class=\"hljs-variable\">car</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Car</span>(<span class=\"hljs-literal\">null</span>,<span class=\"hljs-string\">&quot;1005&quot;</span>,<span class=\"hljs-string\">&quot;红旗&quot;</span>,BigDecimal.valueOf(<span class=\"hljs-number\">20.00</span>),<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Date</span>(),<span class=\"hljs-string\">&quot;燃油车&quot;</span>);<br>    System.out.println(<span class=\"hljs-string\">&quot;影响: &quot;</span> + sqlSession.insert(<span class=\"hljs-string\">&quot;insertCar&quot;</span>, car));<br>    sqlSession.commit();<br>&#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>    <span class=\"hljs-keyword\">if</span>(sqlSession != <span class=\"hljs-literal\">null</span>)&#123;<br>        sqlSession.rollback();<br>\t\tsqlSession.close();<br>    &#125;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>[!Important]</p>\n<p>当插入的是 <code>map</code>  时， <code>Mybatis</code>  底层会使用 <code>map</code>  的 <code>get</code>  方法获取参数值，参数的名字为对于的键名</p>\n<p>当插入的是实体类时， <code>Mybatis</code>  底层会使用 <code>getter</code>  方法获取参数值，参数的名字是 <code>getter方法</code> 去掉 <code>get</code>  后首字母小写的得到的，例如：getUserName ()–&gt; userName。没有 <code>getter</code>  方法时会报错</p>\n</blockquote>\n<h2 id=\"删\"><a class=\"markdownIt-Anchor\" href=\"#删\">#</a> 删</h2>\n<p>根据 <code>Id</code>  删除：</p>\n<p>修改 <code>CarMapper.xml</code> ：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">delete</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;delCar&quot;</span>&gt;</span><br>    delete from t_car where id=#&#123;id&#125;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">delete</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>运行以下代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-type\">SqlSession</span> <span class=\"hljs-variable\">sqlSession</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;<br><span class=\"hljs-keyword\">try</span>&#123;<br>    sqlSession = SqlSessionUtil.getSqlSession();<br>    System.out.println(<span class=\"hljs-string\">&quot;影响: &quot;</span> + sqlSession.getMapper(CarMapper.class).delCar(<span class=\"hljs-number\">6</span>));<br>    sqlSession.commit();<br>&#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>    <span class=\"hljs-keyword\">if</span>(sqlSession != <span class=\"hljs-literal\">null</span>)&#123;<br>        sqlSession.rollback();<br>        sqlSession.close();<br>    &#125;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure>\n<h2 id=\"改\"><a class=\"markdownIt-Anchor\" href=\"#改\">#</a> 改</h2>\n<p>根据 <code>Id</code>  改</p>\n<p>修改 <code>CarMapper.xml</code> ：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">update</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;updateCar&quot;</span>&gt;</span><br>    update t_car set car_num=#&#123;carNum&#125;, brand=#&#123;brand&#125;, guide_price=#&#123;guidePrice&#125;,produce_time=#&#123;produceTime&#125;, car_type=#&#123;carType&#125; where id=#&#123;id&#125;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">update</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>运行以下代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-type\">SqlSession</span> <span class=\"hljs-variable\">sqlSession</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;<br><span class=\"hljs-keyword\">try</span>&#123;<br>    sqlSession = SqlSessionUtil.getSqlSession();<br>    <span class=\"hljs-type\">Car</span> <span class=\"hljs-variable\">car</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Car</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-string\">&quot;1110&quot;</span>,<span class=\"hljs-string\">&quot;丰田&quot;</span>,BigDecimal.valueOf(<span class=\"hljs-number\">30.00</span>),<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Date</span>(),<span class=\"hljs-string\">&quot;新能源车&quot;</span>);<br>    System.out.println(sqlSession.update(<span class=\"hljs-string\">&quot;updateCar&quot;</span>, car));<br>    sqlSession.commit();<br>&#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>    <span class=\"hljs-keyword\">if</span>(sqlSession != <span class=\"hljs-literal\">null</span>)&#123;<br>        sqlSession.rollback();<br>        sqlSession.close();<br>    &#125;<br>    e.printStackTrace();<br>\t&#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n<h2 id=\"查\"><a class=\"markdownIt-Anchor\" href=\"#查\">#</a> 查</h2>\n<p>首先，请在核心配置文件中添加如下配置：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">settings</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">setting</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;mapUnderscoreToCamelCase&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&quot;true&quot;</span>/&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">settings</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"按id查\"><a class=\"markdownIt-Anchor\" href=\"#按id查\">#</a> 按 id 查</h3>\n<p>修改 <code>CarMapper.xml</code> ：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getCarById&quot;</span> <span class=\"hljs-attr\">resultType</span>=<span class=\"hljs-string\">&quot;com.jhy.mybatis.entity.Car&quot;</span>&gt;</span><br>    select * from t_car where id=#&#123;id&#125;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>运行以下代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-type\">SqlSession</span> <span class=\"hljs-variable\">sqlSession</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;<br><span class=\"hljs-keyword\">try</span>&#123;<br>    sqlSession = SqlSessionUtil.getSqlSession();<br>    System.out.println((Car)sqlSession.selectOne(<span class=\"hljs-string\">&quot;getCarById&quot;</span>, <span class=\"hljs-number\">1</span>)); <span class=\"hljs-comment\">//查出来是Object，需要强转</span><br>    sqlSession.commit();<br>&#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>    <span class=\"hljs-keyword\">if</span>(sqlSession != <span class=\"hljs-literal\">null</span>)&#123;<br>        sqlSession.rollback();<br>        sqlSession.close();<br>    &#125;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure>\n<h3 id=\"查全部\"><a class=\"markdownIt-Anchor\" href=\"#查全部\">#</a> 查全部</h3>\n<p>修改 <code>CarMapper.xml</code> ：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getCars&quot;</span> <span class=\"hljs-attr\">resultType</span>=<span class=\"hljs-string\">&quot;com.jhy.mybatis.entity.Car&quot;</span>&gt;</span><br>\tselect * from t_car;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>运行以下代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"> <span class=\"hljs-type\">SqlSession</span> <span class=\"hljs-variable\">sqlSession</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;<br><span class=\"hljs-keyword\">try</span>&#123;<br>    sqlSession = SqlSessionUtil.getSqlSession();<br>    System.out.println(sqlSession.selectList(<span class=\"hljs-string\">&quot;com.jhy.mybatis.mapper.CarMapper.getCars&quot;</span>, CarMapper.class));<br>    System.out.println(list);<br>&#125;<span class=\"hljs-keyword\">catch</span> (Exception e)&#123;<br>    <span class=\"hljs-keyword\">if</span>(sqlSession != <span class=\"hljs-literal\">null</span>)&#123;<br>        sqlSession.rollback();<br>        sqlSession.close();<br>    &#125;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>[!Important]</p>\n<ul>\n<li>\n<p><code>Mybatis</code>  查出来后是一个数据集，要进行映射，必须告诉 <code>Mybatis</code>  如何进行映射。即在 <code>&lt;select&gt;</code>  中声明 <code>resultType</code>  或者 <code>resultMap</code> 。</p>\n</li>\n<li>\n<p><code>resultType</code> ：将结果集和一个类型映射，一般是某个类的全类名。或者是别名</p>\n<ul>\n<li>\n<p>通过核心配置文件中，添加 <code>&lt;typeAliases&gt;&lt;package name=&quot;/path/to/package&quot;/&gt;&lt;/typeAliases&gt;</code> ，来为改包下的所有类添加别名，默认为类名小写</p>\n</li>\n<li>\n<p>或者在想要设置别名的类加上 <code>@Alias(alias)</code> ，来设置别名</p>\n</li>\n<li>\n<p><code>@Alias</code>  会覆盖核心配置文件设置的别名</p>\n</li>\n<li>\n<p><code>resultMap</code> ：自定义映射。见<a href=\"##resultMap\"> resultMap</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><code>&lt;settings&gt; &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt; &lt;/settings&gt;</code> ：开启下划线命名法和驼峰命名法的映射</p>\n</li>\n<li>\n<p>光使用 <code>resultType</code>  还不行，因为数据库一般是下划线命名法， <code>java</code>  是驼峰命名法， <code>Mybatis</code>  不知道将字段映射至哪个属性上。开启这个设置后，将会使驼峰命名的属性和下划线命名的字段映射</p>\n</li>\n<li>\n<p>若属性和字段相同 <code>Mybatis</code>  会自动映射，因此不用开启下划线命名法和驼峰命名法的映射</p>\n</li>\n<li>\n<p>使用字段别名也可以进行映射</p>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>[!Important]</p>\n<p><code>namespace</code> ：命名空间。就像 <code>c++</code>  的命名空间和 <code>java</code>  的包一样，为了区分出映射语句 <code>id</code>  的所处的范围。防止重名。</p>\n<p>完整的引用应该是： <code>namepace.id</code> 。当没有 <code>id</code>  重名是，仅仅使用 <code>id</code>  就能区分，有 <code>id</code>  重名时，必须使用完整的引用</p>\n</blockquote>\n<h1 id=\"核心配置文件详解\"><a class=\"markdownIt-Anchor\" href=\"#核心配置文件详解\">#</a> 核心配置文件详解</h1>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-comment\">&lt;!--properties：用于设置属性，或者引入properties文件--&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">properties</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&quot;&quot;</span>/&gt;</span>  <span class=\"hljs-comment\">&lt;!--通过$&#123;name&#125;即可获取value的值--&gt;</span><br>    ...<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">properties</span>&gt;</span><br><br><span class=\"hljs-comment\">&lt;!--properties resource=&quot;/path/to/properties&quot;/--&gt;</span> <span class=\"hljs-comment\">&lt;!--用于引入properties文件，同样可以用$&#123;name&#125;的方式获取value的值--&gt;</span><br><span class=\"hljs-comment\">&lt;!--environments包裹enviroment标签， defualt代表默认的环境id，创建SqlSessionFactory实例时，未指明环境使用的默认环境--&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">environments</span> <span class=\"hljs-attr\">default</span>=<span class=\"hljs-string\">&quot;development&quot;</span>&gt;</span> <br>    <span class=\"hljs-comment\">&lt;!--环境，一般对于着一个数据库，一数据库对应着一个SqlSessionFactory，id为该环境的唯一标识--&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">environment</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;development&quot;</span>&gt;</span> <br>        <span class=\"hljs-comment\">&lt;!--</span><br><span class=\"hljs-comment\">\t\t\ttransactionManager：申明使用哪种事务管理。</span><br><span class=\"hljs-comment\">\t\t--&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">transactionManager</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;JDBC&quot;</span>/&gt;</span><br>        <span class=\"hljs-comment\">&lt;!--</span><br><span class=\"hljs-comment\">\t\t\tdataSource：数据源==连接池，通过数据源获取提供connection对象。DataSource是JDK提供的规范，有很多实现</span><br><span class=\"hljs-comment\">\t\t\ttype：使用声明方式获取Connection实例 [POOLED|UNPOOLED|JNDI]</span><br><span class=\"hljs-comment\">\t\t\tUNPOOLED：不适应数据库连接池技术，每一次连接都会创建新的Connection实例</span><br><span class=\"hljs-comment\">\t\t\tPOOLED：使用Mybatis自己实现的数据库连接池</span><br><span class=\"hljs-comment\">\t\t\tJNDI：使用第三方的数据库连接池</span><br><span class=\"hljs-comment\">\t\t--&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dataSource</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;POOLED&quot;</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;driver&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;url&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&quot;$&#123;url&#125;&quot;</span>/&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;username&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&quot;$&#123;username&#125;&quot;</span>/&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">property</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;password&quot;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&quot;$&#123;password&#125;&quot;</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dataSource</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">environment</span>&gt;</span><br>    ... <span class=\"hljs-comment\">&lt;!--可以创建多个环境--&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">environments</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h1 id=\"mybatis的核心类\"><a class=\"markdownIt-Anchor\" href=\"#mybatis的核心类\">#</a> Mybatis 的核心类</h1>\n<h2 id=\"sqlsessionfactorybuilder\"><a class=\"markdownIt-Anchor\" href=\"#sqlsessionfactorybuilder\">#</a> SqlSessionFactoryBuilder</h2>\n<p>这个类可以被实例化、使用和丢弃，一旦创建了 <code>SqlSessionFactory</code> ，就不再需要它了。 因此 <code>SqlSessionFactoryBuilder</code>  实例的最佳作用域是方法作用域（也就是局部方法变量）。 你可以重用 <code>SqlSessionFactoryBuilder</code>  来创建多个 <code>SqlSessionFactory</code>  实例，但最好还是不要一直保留着它，以保证所有的 <code>XML</code>  解析资源可以被释放给更重要的事情。</p>\n<h2 id=\"sqlsessionfactory\"><a class=\"markdownIt-Anchor\" href=\"#sqlsessionfactory\">#</a> SqlSessionFactory</h2>\n<p><code>SqlSessionFactory</code>  一旦被创建就应该在应用的运行期间一直存在，没有任何理由丢弃它或重新创建另一个实例。 使用 <code>SqlSessionFactory</code>  的最佳实践是在应用运行期间不要重复创建多次，多次重建 <code>SqlSessionFactory</code>  被视为一种代码<strong>坏习惯</strong>。因此 <code>SqlSessionFactory</code>  的最佳作用域是应用作用域。有很多方法可以做到，最简单的就是使用单例模式或者静态单例模式。</p>\n<h2 id=\"sqlsession\"><a class=\"markdownIt-Anchor\" href=\"#sqlsession\">#</a> SqlSession</h2>\n<p>每个线程都应该有它自己的 <code>SqlSession</code>  实例。 <code>SqlSession</code>  的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。 绝对不能将 <code>SqlSession </code> 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行。 也绝不能将 <code>SqlSession</code>  实例的引用放在任何类型的托管作用域中，比如 <code>Servlet</code>  框架中的 <code>HttpSession</code> 。如果你现在正在使用一种 <code>Web</code>  框架，考虑将 <code>SqlSession</code>  放在一个和 HTTP 请求相似的作用域中。换句话说，每次收到 HTTP 请求，就可以打开一个 <code>SqlSession</code> ，返回一个响应后，就关闭它。 这个关闭操作很重要，为了确保每次都能执行关闭操作，你应该把这个关闭操作放到 <code>finally</code>  块中。</p>\n<h1 id=\"mybatis代理\"><a class=\"markdownIt-Anchor\" href=\"#mybatis代理\">#</a> Mybatis 代理</h1>\n<p>如果，你使用之前所述的方法在 <code>web</code>  钟进行查询，是否发现了， <code>dao</code>  层书写的代码大同小异。几乎一模一样。有没有简单的方法执行 <code>sql</code>  语句？</p>\n<blockquote>\n<p>答案是有。 <code>Mybatis</code>  底层封装了 <code>javassist</code>  进行动态代理，使用者可以只书写一个接口， <code>Mybatis</code>  可以为这个接口创建一个动态代理类。这样我们并不用自己区写一个访问数据库的方法。</p>\n</blockquote>\n<p><code>Mybatis</code> t 通过 <code>javassist</code>  实现接口和其中的方法。那么问题来了， <code>Mybatis</code>  底层如何获得的 <code>sql</code>  语句？</p>\n<blockquote>\n<p><code>Mybatis</code>  可以通过映射文件的标签中的 <code>id</code>  获得其中的 <code>sql</code>  语句</p>\n</blockquote>\n<p>既然可以通过 <code>id</code>  获取 <code>sql</code>  语句，那么 <code>Mybatis</code>  如何知道使用者书写的 <code>id</code>  和插入的对应方法？</p>\n<blockquote>\n<p><code>Mybatis</code>  规定：如果使用动态代理的方式执行 <code>sql</code>  语句，那么映射文件中的 <code>namespace</code>  应该是对应接口的完全限定类名，映射语句的 <code>id</code> ，应该是对应方法的方法名。</p>\n<p>而如果你不适应动态代理的方式执行 <code>sql</code>  语句，则没有上述规定。</p>\n</blockquote>\n<p><code>Mybatis</code>  通过以下方式获得动态代理类：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">sqlsession.getMapper(xxx.class) <span class=\"hljs-comment\">//这样将获得xxx接口的代理类，这样就可以通过代理类的方法执行sql</span><br></code></pre></td></tr></table></figure>\n<h1 id=\"小技巧\"><a class=\"markdownIt-Anchor\" href=\"#小技巧\">#</a> 小技巧</h1>\n<h2 id=\"和的区别\"><a class=\"markdownIt-Anchor\" href=\"#和的区别\">#</a> #{} 和 ${} 的区别</h2>\n<p>实际上， <code>Mybatis</code>  提供 <code>#&#123;&#125;</code>  和 <code>$&#123;&#125;</code>  来进行传参。 <code>&#123;&#125;</code>  中填入传值的参数</p>\n<ul>\n<li><code>#&#123;&#125;</code> ：底层使用 <code>PreparedStatement</code> ，会先进行 <code>sql</code>  的编译，相当 <code>?</code>  占位符，对字符串来说会自动添加引号。</li>\n<li><code>$&#123;&#125;</code> ：底层使用 <code>Staement</code> ，会先进行字符串的拼接，对字符串来说就是没有引号。无法防止 <code>sql</code>  注入，只有在字符串拼接的情况下才使用。</li>\n</ul>\n<h2 id=\"typealiases\"><a class=\"markdownIt-Anchor\" href=\"#typealiases\">#</a> typeAliases</h2>\n<p><code>typeAliases</code>  为核心配置文件的标签。为 <code>resultType</code>  提供别名。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">typeAliases</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">typeAlias</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;/reference/to/class&quot;</span> <span class=\"hljs-attr\">alias</span>=<span class=\"hljs-string\">&quot;alias&quot;</span>/&gt;</span> #type为起别名类的完全限定名，alias为别名<br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">typeAlias</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;/reference/to/class&quot;</span>/&gt;</span> #省略alias，将会使用类的默认简名————去掉包名，且别名不分大小写<br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">package</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;/path/to/package&quot;</span>/&gt;</span> #为该包下的所有类起别名，同样使用类的默认简名<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">typeAliases</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p><code>Mybatis</code>  为常用的类型提供了别名。参考文档：<a href=\"https://mybatis.net.cn/configuration.html#typeAliases\">MyBatis 内置别名</a></p>\n</blockquote>\n<h2 id=\"mappers标签的细节\"><a class=\"markdownIt-Anchor\" href=\"#mappers标签的细节\">#</a> mappers 标签的细节</h2>\n<p><code>mappers</code>  为核心配置文件的标签。包含映射文件的路径</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mappers</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">resource</span>=<span class=\"hljs-string\">&quot;/path/to/xml&quot;</span>/&gt;</span> #从项目根路径开始找映射文件<br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">url</span>=<span class=\"hljs-string\">&quot;file:///absolute/path/to/xml&quot;</span>/&gt;</span> #定位计算机本地的映射文件<br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;reference.to.class&quot;</span>/&gt;</span> #通过接口名找到的映射文件，Mybatis会从reference/to/class.xml找映射文件<br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">package</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;reference.to.package&quot;</span>/&gt;</span> #找到该包下的映射文件<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mappers</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>[!Important]</p>\n<p>使用第 3 和第 4 种方式，必须保证：</p>\n<ul>\n<li>映射文件和接口同名</li>\n<li>映射文件和接口处同一目录下</li>\n</ul>\n</blockquote>\n<h2 id=\"插入数据时自动获取生成的主键\"><a class=\"markdownIt-Anchor\" href=\"#插入数据时自动获取生成的主键\">#</a> 插入数据时自动获取生成的主键</h2>\n<p>在 <code>&lt;insert&gt;</code>  标签中开启 <code>useGeneratedKey</code> ，表明开启自动获取生成的主键，同时设置 <code>keyProperty</code> ，实体类的哪个属性作为返回的主键</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">insert</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">useGeneratedKey</span>=<span class=\"hljs-string\">&quot;true&quot;</span> <span class=\"hljs-attr\">keyProperty</span>=<span class=\"hljs-string\">&quot;&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure>\n<p>当插入完成后， <code>Mybatis</code>  会自动给实体类的这个参数赋值为生成的主键。</p>\n<h1 id=\"参数\"><a class=\"markdownIt-Anchor\" href=\"#参数\">#</a> 参数</h1>\n<p><code>Mybatis</code>  简单参数：</p>\n<ul>\n<li>\n<p>byte short int long float double</p>\n</li>\n<li>\n<p>Byte Short Integer Long Float Double</p>\n</li>\n<li>\n<p>String</p>\n</li>\n<li>\n<p>java.util.Date</p>\n</li>\n<li>\n<p>java.sql.Date</p>\n</li>\n</ul>\n<h2 id=\"单个简单参数\"><a class=\"markdownIt-Anchor\" href=\"#单个简单参数\">#</a> 单个简单参数</h2>\n<p>使用单个简单参数时， <code>#&#123;&#125;</code>  和 <code>$&#123;&#125;</code>  中的 <code>&#123;&#125;</code>  的参数可以随便写。对于 <code>#&#123;&#125;</code> ， <code>Mybatis</code>  底层仍然使用 <code>preparedStatement.setxxx()</code>  方法向占位符赋值。 <code>Mybatis</code>  底层会猜出简单参数的类型。</p>\n<blockquote>\n<p>[!Note]</p>\n<p>实际上，在每个映射块中可以使用 <code>parameterType</code>  属性来指明参数的类型，但可以不写， <code>Mybatis</code>  可以猜出来。</p>\n</blockquote>\n<h2 id=\"map集合参数\"><a class=\"markdownIt-Anchor\" href=\"#map集合参数\">#</a> Map 集合参数</h2>\n<p><code>Mybatis</code>  底层会使用 <code>map</code>  的 <code>get</code>  方法获取参数值，， <code>#&#123;&#125;</code>  和 <code>$&#123;&#125;</code>  中的 <code>&#123;&#125;</code>  的参数的名字为对应的键名</p>\n<h2 id=\"实体类参数\"><a class=\"markdownIt-Anchor\" href=\"#实体类参数\">#</a> 实体类参数</h2>\n<p><code>Mybatis</code>  底层会使用 <code>getter</code>  方法获取参数值，， <code>#&#123;&#125;</code>  和 <code>$&#123;&#125;</code>  中的 <code>&#123;&#125;</code>  的参数的名字是 <code>getter方法</code> 去掉 <code>get</code>  后首字母小写的得到的，例如：getUserName ()–&gt; userName。没有 <code>getter</code>  方法时会报错</p>\n<h2 id=\"多参数\"><a class=\"markdownIt-Anchor\" href=\"#多参数\">#</a> 多参数</h2>\n<p><code>Mybatis</code>  底层会自动创建一个 <code>map</code>  集合，以以下方式存放：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">map.put(<span class=\"hljs-string\">&quot;arg0&quot;</span>,param1)<br>map.put(<span class=\"hljs-string\">&quot;arg1&quot;</span>,param2)<br>...<br>map.put(<span class=\"hljs-string\">&quot;param1&quot;</span>,param0)<br>map.put(<span class=\"hljs-string\">&quot;param2&quot;</span>,param1)<br></code></pre></td></tr></table></figure>\n<p>因此可以使用以下方式引用参数值：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">#&#123;arg0&#125;,#&#123;agr1&#125;...<br>$&#123;arg0&#125;,$&#123;arg1&#125;...<br>#&#123;param1&#125;,#&#123;param2&#125;...<br>$&#123;param1&#125;,$&#123;param2&#125;...<br></code></pre></td></tr></table></figure>\n<h3 id=\"param注解\"><a class=\"markdownIt-Anchor\" href=\"#param注解\">#</a> @Param 注解</h3>\n<p>可以自己指定 <code>map</code>  中的 <code>key</code>  是什么，如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> xxx <span class=\"hljs-title function_\">getXXX</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@Param(&quot;yy&quot;)</span>xx yy)</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>[!Note]</p>\n<p>此方法会让前缀为 <code>arg</code>  的键失效，但前缀为 <code>param</code>  的键依然存在</p>\n</blockquote>\n<h2 id=\"数组或者list集合参数\"><a class=\"markdownIt-Anchor\" href=\"#数组或者list集合参数\">#</a> 数组或者 List 集合参数</h2>\n<p>此参数要配合 <code>foreach</code>  标签使用。 <code>foreach</code>  标签见<a href=\"##foreach\"> foreach</a></p>\n<h1 id=\"查询返回\"><a class=\"markdownIt-Anchor\" href=\"#查询返回\">#</a> 查询返回</h1>\n<h2 id=\"返回单个\"><a class=\"markdownIt-Anchor\" href=\"#返回单个\">#</a> 返回单个</h2>\n<h3 id=\"返回单个对象实例\"><a class=\"markdownIt-Anchor\" href=\"#返回单个对象实例\">#</a> 返回单个对象实例</h3>\n<h4 id=\"返回实体类\"><a class=\"markdownIt-Anchor\" href=\"#返回实体类\">#</a> 返回实体类</h4>\n<p>在映射块中表面 <code>resultType</code>  的类型， <code>Mybatis</code>  将自动进行结果集映射。</p>\n<blockquote>\n<p>若返回条数是多个，使用实体类接受会产生 <code>TooManyResultException</code>  错误</p>\n</blockquote>\n<h4 id=\"返回没有适合的实体类的结果集\"><a class=\"markdownIt-Anchor\" href=\"#返回没有适合的实体类的结果集\">#</a> 返回没有适合的实体类的结果集</h4>\n<p>返回的结果集没有适合的实体类接受，则可以使用 <code>map&lt;String, Object&gt;</code>  进行接受，同时指定 <code>resultType</code>  为 <code>map</code></p>\n<h3 id=\"返回单个简单类型\"><a class=\"markdownIt-Anchor\" href=\"#返回单个简单类型\">#</a> 返回单个简单类型</h3>\n<p>用对应的简单类型接受即可。</p>\n<h2 id=\"返回多个\"><a class=\"markdownIt-Anchor\" href=\"#返回多个\">#</a> 返回多个</h2>\n<h3 id=\"返回多个对象实例\"><a class=\"markdownIt-Anchor\" href=\"#返回多个对象实例\">#</a> 返回多个对象实例</h3>\n<h4 id=\"返回实体类-2\"><a class=\"markdownIt-Anchor\" href=\"#返回实体类-2\">#</a> 返回实体类</h4>\n<p>返回的结果集有多个。用 <code>List&lt;eneity&gt;</code>  接受。在映射块中表明 <code>resultType</code>  的类型， <code>Mybatis</code>  将自动进行结果集映射。同样的，此方法也可以接受返回单个结果集的结果</p>\n<h4 id=\"返回没有适合的实体类的结果集-2\"><a class=\"markdownIt-Anchor\" href=\"#返回没有适合的实体类的结果集-2\">#</a> 返回没有适合的实体类的结果集</h4>\n<p>返回的结果集没有适合的实体类接受，则可以使用 <code>List&lt;map&lt;String, Object&gt;&gt;</code>  进行接受，同时指定 <code>resultType</code>  为 <code>map</code></p>\n<h3 id=\"返回多个简单类型\"><a class=\"markdownIt-Anchor\" href=\"#返回多个简单类型\">#</a> 返回多个简单类型</h3>\n<p>用对应的简单类型 <code>List</code>  集合接受即可。</p>\n<h2 id=\"大map\"><a class=\"markdownIt-Anchor\" href=\"#大map\">#</a> 大 map</h2>\n<p>使用 <code>map&lt;key, map&lt;String, Object&gt;&gt;</code>  的方式进行映射。区别于简单的 <code>map</code>  集合映射，该方法支持通过主键的方式引用结果集。</p>\n<p>其中 <code>key</code>  是主键的类型， <code>map&lt;String, Object&gt;</code>  是主键对应的 <code>map</code>  集合。作为 <code>key</code>  的字段需通过 <code>@MapKey(&quot;&quot;)</code>  进行声明。同样的指定 <code>resultType</code>  为 <code>map</code></p>\n<h2 id=\"resultmap\"><a class=\"markdownIt-Anchor\" href=\"#resultmap\">#</a> resultMap</h2>\n<p>自定义结果集映射。</p>\n<p>查询结果集的字段和实体类对不上的解决方案：</p>\n<ul>\n<li>通过 <code>as</code>  起别名</li>\n<li><strong>使用 <code>resultMap</code> </strong></li>\n<li>使用下划线驼峰映射</li>\n</ul>\n<p>如下形式：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span> <span class=\"hljs-comment\">&lt;!--id为resultMap的唯一标识，type为映射的实体类--&gt;</span><br>\t<span class=\"hljs-comment\">&lt;!--property为实体类的属性名，column为字段名--&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;&quot;</span>/&gt;</span> <span class=\"hljs-comment\">&lt;!--id标签为主键的映射，不是必须的，但配上会让Mybatis提高效率--&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;&quot;</span>/&gt;</span> <span class=\"hljs-comment\">&lt;!--result标签为主键的映射--&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span><br><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">&quot;id&quot;</span>/&gt;</span>  <span class=\"hljs-comment\">&lt;!--resultMap为上面定义的resultMap的id--&gt;</span><br></code></pre></td></tr></table></figure>\n<h1 id=\"动态sql\"><a class=\"markdownIt-Anchor\" href=\"#动态sql\">#</a> 动态 SQL</h1>\n<h2 id=\"if标签\"><a class=\"markdownIt-Anchor\" href=\"#if标签\">#</a> if 标签</h2>\n<p>相当于 if 语句，条件成立则执行，如下形式：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">&quot;xx != null and xx != &#x27;&#x27;&quot;</span>&gt;</span> <span class=\"hljs-comment\">&lt;!--test中写判断条件--&gt;</span><br>\t...<span class=\"hljs-comment\">&lt;!--写sql分句--&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>[!Important]</p>\n<ol>\n<li><code>if</code>  标签中 <code>test</code>  属性是必须的。</li>\n<li><code>if</code>  标签中 <code>test</code>  属性的值是 <code>false</code>  或者 <code>true</code> 。 如果 <code>test</code>  是 <code>true</code> ，则 <code>if</code>  标签中的 <code>sql</code>  语句就会拼接。反之，则不会拼接。</li>\n<li><code>test</code>  属性中可以使用的是:</li>\n</ol>\n<ul>\n<li>当使用了 <code>@Param</code>  主解，那么 <code>test</code>  中要出现的是 <code>Param</code>  注解指定的参数名。 <code>@Param(&quot;brand&quot;)</code> ，那么这里只能使用 <code>brand</code></li>\n<li>当没有使用 <code>@Param</code>  注解，那么 <code>test</code>  中要出现的是:  <code>param1</code>   <code>param2</code>   <code>param3</code> …  <code>arg0</code>   <code>arg1``arg2</code> …</li>\n<li>当使用了实体类，那么 test 中出现的是实体类的属性名。</li>\n<li>在 mybatis 的动态 SQL 当中，不能使用 &amp;&amp;，只能使用 and</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>当出现多个 <code>if</code>  时，可能会出现 <code>and</code>  多了或者少了的语法错误</p>\n</blockquote>\n<h2 id=\"where标签\"><a class=\"markdownIt-Anchor\" href=\"#where标签\">#</a> where 标签</h2>\n<p><code>where</code>  标签的作用：让 where 子句更加动态智能，且会动态添加 <code>where</code>  关键字</p>\n<ul>\n<li>所有条件都为空时， <code>where</code>  标签保证不会生成 <code>where</code>  子句</li>\n<li>自动去除某些条件 **<mark> 前面</mark> ** 多余的 <code>and</code>  或 <code>or</code> 。</li>\n</ul>\n<h2 id=\"trim标签\"><a class=\"markdownIt-Anchor\" href=\"#trim标签\">#</a> trim 标签</h2>\n<p>比 <code>where</code>  更加智能，包含 4 个属性，如下形式</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">trim</span> <span class=\"hljs-attr\">prefix</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">subfix</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">prefixOverrides</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">subfixOverrides</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span><br>    <span class=\"hljs-comment\">&lt;!--</span><br><span class=\"hljs-comment\">\t\tprefix：在trim标签前动态添加前缀，所有条件都为空，则不会添加。prefix=&quot;where&quot;，在整个标签前动态添加where</span><br><span class=\"hljs-comment\">\t\tsubfix：添加后缀</span><br><span class=\"hljs-comment\">\t\tprefixOverrides：删除前缀</span><br><span class=\"hljs-comment\">\t\tsubfixOverrides：删除trim标签的后缀。subfixOverrides=&quot;and|or&quot; |代表或者，在trim标签的末尾删除and或者or</span><br><span class=\"hljs-comment\">\t--&gt;</span><br>\t...<span class=\"hljs-comment\">&lt;!--写sql分句--&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">trim</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"set\"><a class=\"markdownIt-Anchor\" href=\"#set\">#</a> set</h2>\n<p>主要使用在 <code>update</code>  语句当中，用来同态生成 <code>set</code>  关键字，同时去掉最后多余的逗号。比如我们只更新提交的不为空的字段，如果提交的数据是空或者 <code>””</code> ，那么这个字段我们将不更新。</p>\n<p>如下形式：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">update xxx <br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">set</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span>...<span class=\"hljs-comment\">&lt;!--写sql分句--&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span>...<span class=\"hljs-comment\">&lt;!--写sql分句--&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span>...<span class=\"hljs-comment\">&lt;!--写sql分句--&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>    ...<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">set</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"choose-when-otherwise\"><a class=\"markdownIt-Anchor\" href=\"#choose-when-otherwise\">#</a> choose、when、otherwise</h2>\n<p>相当于 <code>switch-case-default</code>  的选择流程控制。形式如下</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">choose</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">when</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span>...<span class=\"hljs-comment\">&lt;!--写sql分句--&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">when</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">when</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span>...<span class=\"hljs-comment\">&lt;!--写sql分句--&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">when</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">when</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span>...<span class=\"hljs-comment\">&lt;!--写sql分句--&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">when</span>&gt;</span><br>    ...<br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">otherwise</span>&gt;</span>...<span class=\"hljs-comment\">&lt;!--写sql分句--&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">otherwise</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">choose</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"foreach\"><a class=\"markdownIt-Anchor\" href=\"#foreach\">#</a> foreach</h2>\n<p>相当于 <code>java</code>  的 <code>foreach</code>  循环，形式如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">foreach</span> <span class=\"hljs-attr\">collection</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">item</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">separator</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">open</span>=<span class=\"hljs-string\">&quot;&quot;</span> <span class=\"hljs-attr\">close</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span><br>    <span class=\"hljs-comment\">&lt;!--</span><br><span class=\"hljs-comment\">\t\tcollection: 指定数组或者集合</span><br><span class=\"hljs-comment\">\t\titem：代表数组或集合中的元素</span><br><span class=\"hljs-comment\">\t\tseparator：分割符。每次循环之间的分隔符</span><br><span class=\"hljs-comment\">\t\topen：foreach拼接的sql语句以什么开始</span><br><span class=\"hljs-comment\">\t\tclose：foreach拼接的sql语句以什么结束</span><br><span class=\"hljs-comment\">\t--&gt;</span><br>\t...<span class=\"hljs-comment\">&lt;!--写sql分句--&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">foreach</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"sql-include\"><a class=\"markdownIt-Anchor\" href=\"#sql-include\">#</a> sql、include</h2>\n<p>形式如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sql</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;&quot;</span>&gt;</span><span class=\"hljs-comment\">&lt;!--声明sql片段--&gt;</span><br>\t...<span class=\"hljs-comment\">&lt;!--写sql分句--&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sql</span>&gt;</span> <br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">&quot;id&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">include</span>&gt;</span> <span class=\"hljs-comment\">&lt;!--引入sql片段--&gt;</span><br></code></pre></td></tr></table></figure>\n<h1 id=\"高级映射\"><a class=\"markdownIt-Anchor\" href=\"#高级映射\">#</a> 高级映射</h1>\n<p>通过 <code>resultMap</code>  能支持多表之间的联表查询，下面介绍一对一、一对多、多对多的关系</p>\n<h2 id=\"一对一\"><a class=\"markdownIt-Anchor\" href=\"#一对一\">#</a> 一对一</h2>\n<p>以国家表和首都表为例：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">create</span> <span class=\"hljs-keyword\">table</span> if <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">exists</span> t_country(<br>    id <span class=\"hljs-type\">bigint</span> <span class=\"hljs-keyword\">primary</span> key auto_increment,<br>    country_name <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>),<br>    capital_id <span class=\"hljs-type\">bigint</span><br>);<br><br><span class=\"hljs-keyword\">create</span> <span class=\"hljs-keyword\">table</span> if <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">exists</span> t_capital(<br>    id <span class=\"hljs-type\">bigint</span> <span class=\"hljs-keyword\">primary</span> key auto_increment,<br>    capital_name <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>),<br>    population <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>)<br>)<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>一个国家对应一个首都</p>\n</blockquote>\n<p>实体类如下设计：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Country</span> &#123; <span class=\"hljs-comment\">//国家</span><br>    Long id;<br>    String countryName;<br>    Capital capital;<br>&#125;<br><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Capital</span> &#123; <span class=\"hljs-comment\">//首都</span><br>    Long id;<br>    String capitalName;<br>    String population;<br>    Country country;<br>&#125;<br></code></pre></td></tr></table></figure>\n<h3 id=\"查询一个国家及其首都\"><a class=\"markdownIt-Anchor\" href=\"#查询一个国家及其首都\">#</a> 查询一个国家及其首都</h3>\n<p>以国家表为主表，首都标为副表。</p>\n<h4 id=\"级联查询\"><a class=\"markdownIt-Anchor\" href=\"#级联查询\">#</a> 级联查询</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;countryCascade&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;country&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;id&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;id&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;capital.id&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;capital_id&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;countryName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;country_name&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;capital.capitalName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;capital_name&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;capital.population&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;population&quot;</span>/&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getCountryCascade&quot;</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">&quot;countryCascade&quot;</span>&gt;</span><br>    select * from  t_country join t_capital on t_country.capital_id = t_capital.id where t_country.id = #&#123;id&#125;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"association\"><a class=\"markdownIt-Anchor\" href=\"#association\">#</a> association</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;countryAssociation&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;country&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;id&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;id&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;countryName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;country_name&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">association</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;capital&quot;</span> <span class=\"hljs-attr\">javaType</span>=<span class=\"hljs-string\">&quot;capital&quot;</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;id&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;capital_id&quot;</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;capitalName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;capital_name&quot;</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;population&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;population&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">association</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getCountryAssociation&quot;</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">&quot;countryAssociation&quot;</span>&gt;</span><br>    select * from  t_country join t_capital on t_country.capital_id = t_capital.id where t_country.id = #&#123;id&#125;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"分步查询\"><a class=\"markdownIt-Anchor\" href=\"#分步查询\">#</a> 分步查询</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;countryStep&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;country&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;id&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;id&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;countryName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;country_name&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">association</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;capital&quot;</span> <span class=\"hljs-attr\">select</span>=<span class=\"hljs-string\">&quot;com.jhy.advanced.mapper.CapitalMapper.getCapital&quot;</span> <span class=\"hljs-attr\">javaType</span>=<span class=\"hljs-string\">&quot;capital&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;capital_id&quot;</span>/&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getCountryStep&quot;</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">&quot;countryStep&quot;</span>&gt;</span><br>    select * from t_country where id=#&#123;id&#125;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br><br><span class=\"hljs-comment\">&lt;!--CapitalMapper.xml--&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">namespace</span>=<span class=\"hljs-string\">&quot;com.jhy.advanced.mapper.CapitalMapper&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getCapitalStep&quot;</span> <span class=\"hljs-attr\">resultType</span>=<span class=\"hljs-string\">&quot;capital&quot;</span>&gt;</span><br>        select * from t_capital where id=#&#123;id&#125;<br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>优点：降低联表时的性能损耗；支持懒加载</p>\n<h3 id=\"查询一个首都及其所属国家\"><a class=\"markdownIt-Anchor\" href=\"#查询一个首都及其所属国家\">#</a> 查询一个首都及其所属国家</h3>\n<p>以首都表为主表，国家表为从表。其余与<strong>查询一个国家及其首都</strong>一样。</p>\n<h2 id=\"一对多\"><a class=\"markdownIt-Anchor\" href=\"#一对多\">#</a> 一对多</h2>\n<p>以学生表和班级表为例：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">create</span> <span class=\"hljs-keyword\">table</span> if <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">exists</span> t_clazz<br>(<br>    c_id   <span class=\"hljs-type\">bigint</span> auto_increment <span class=\"hljs-keyword\">primary</span> key,<br>    c_name <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">null</span><br>);<br><br><span class=\"hljs-keyword\">create</span> <span class=\"hljs-keyword\">table</span> if <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">exists</span> t_student<br>(<br>    s_id     <span class=\"hljs-type\">bigint</span> auto_increment <span class=\"hljs-keyword\">primary</span> key,<br>    s_name   text,<br>    c_id   <span class=\"hljs-type\">bigint</span>,<br>);<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>一个班级包含多个学生。一个学生属于一个班级</p>\n</blockquote>\n<p>则实体类应该设计如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Clazz</span> &#123; <span class=\"hljs-comment\">//班级</span><br>    <span class=\"hljs-type\">int</span> cId;<br>    String cName;<br>    List&lt;Student&gt; students; <span class=\"hljs-comment\">//多个学生</span><br>&#125;<br><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Student</span> &#123; <span class=\"hljs-comment\">//学生</span><br>    <span class=\"hljs-type\">int</span> sId;<br>    String sName;<br>    Clazz clazz; <span class=\"hljs-comment\">//从属一个班级</span><br>&#125;<br></code></pre></td></tr></table></figure>\n<h3 id=\"查询一个班级及其包含的学生\"><a class=\"markdownIt-Anchor\" href=\"#查询一个班级及其包含的学生\">#</a> 查询一个班级及其包含的学生</h3>\n<h4 id=\"collection\"><a class=\"markdownIt-Anchor\" href=\"#collection\">#</a> collection</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;clazzCollection&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;Clazz&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;cId&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;c_id&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;cName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;c_name&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">collection</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;students&quot;</span> <span class=\"hljs-attr\">ofType</span>=<span class=\"hljs-string\">&quot;Student&quot;</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;sId&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;s_id&quot;</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;sName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;s_name&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">collection</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getClazzCollection&quot;</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">&quot;clazzCollection&quot;</span>&gt;</span><br>    select * from t_clazz natural join t_student where t_clazz.c_id = #&#123;id&#125;;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"分步查询-2\"><a class=\"markdownIt-Anchor\" href=\"#分步查询-2\">#</a> 分步查询</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;clazzStep&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;Clazz&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;cId&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;c_id&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;cName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;c_name&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">collection</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;students&quot;</span> <span class=\"hljs-attr\">ofType</span>=<span class=\"hljs-string\">&quot;student&quot;</span> <span class=\"hljs-attr\">select</span>=<span class=\"hljs-string\">&quot;com.jhy.advanced.mapper.StudentMapper.getClazzStepTwo&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;c_id&quot;</span>/&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getClazzStepOne&quot;</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">&quot;clazzStep&quot;</span>&gt;</span><br>    select * from t_clazz where t_clazz.c_id = #&#123;id&#125;;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br><br><span class=\"hljs-comment\">&lt;!--StudentMapper.xml--&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">namespace</span>=<span class=\"hljs-string\">&quot;com.jhy.advanced.mapper.StudentMapper&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getClazzStepTwo&quot;</span> <span class=\"hljs-attr\">resultType</span>=<span class=\"hljs-string\">&quot;Student&quot;</span>&gt;</span><br>        select * from t_student where c_id=#&#123;id&#125;<br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"查询一个学生及其所属的班级\"><a class=\"markdownIt-Anchor\" href=\"#查询一个学生及其所属的班级\">#</a> 查询一个学生及其所属的班级</h3>\n<h4 id=\"级联查询-2\"><a class=\"markdownIt-Anchor\" href=\"#级联查询-2\">#</a> 级联查询</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;studentCacade&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;Student&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;sId&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;s_id&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;sName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;s_name&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;clazz.cName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;c_name&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">result</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;clazz.cId&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;c_id&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">result</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getStudentCascade&quot;</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">&quot;studentCacade&quot;</span>&gt;</span><br>    select * from t_student natural join t_clazz where s_id=#&#123;id&#125;;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"association-2\"><a class=\"markdownIt-Anchor\" href=\"#association-2\">#</a> association</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;studentAssociation&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;Student&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;sId&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;s_id&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;sName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;s_name&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">association</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;clazz&quot;</span> <span class=\"hljs-attr\">javaType</span>=<span class=\"hljs-string\">&quot;clazz&quot;</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;cName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;c_name&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">result</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;cId&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;c_id&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">result</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">association</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getStudentAssociation&quot;</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">&quot;studentAssociation&quot;</span>&gt;</span><br>    select * from t_student natural join t_clazz where s_id=#&#123;id&#125;;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h4 id=\"分步查询-3\"><a class=\"markdownIt-Anchor\" href=\"#分步查询-3\">#</a> 分步查询</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;studentStep&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;Student&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;sId&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;s_id&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;sName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;s_name&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">association</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;clazz&quot;</span> <span class=\"hljs-attr\">select</span>=<span class=\"hljs-string\">&quot;com.jhy.advanced.mapper.ClazzMapper.getStudentStepTwo&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;c_id&quot;</span>/&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getStudentStepOne&quot;</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">&quot;studentStep&quot;</span>&gt;</span><br>    select * from t_student where s_id=#&#123;id&#125;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br><br><span class=\"hljs-comment\">&lt;!--ClazzMapper.xml--&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">namespace</span>=<span class=\"hljs-string\">&quot;com.jhy.advanced.mapper.ClazzMapper&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getClazzStepOne&quot;</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">&quot;clazzStep&quot;</span>&gt;</span><br>        select * from t_clazz where t_clazz.c_id = #&#123;id&#125;;<br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h2 id=\"多对多\"><a class=\"markdownIt-Anchor\" href=\"#多对多\">#</a> 多对多</h2>\n<p>以用户表、文章表，评论表为例：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">create</span> <span class=\"hljs-keyword\">table</span> if <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">exists</span> t_user( <br>    u_id <span class=\"hljs-type\">bigint</span> <span class=\"hljs-keyword\">primary</span> key auto_increment,<br>    user_name <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>)<br>);<br><br><span class=\"hljs-keyword\">create</span> <span class=\"hljs-keyword\">table</span> if <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">exists</span> t_paper(<br>    p_id <span class=\"hljs-type\">bigint</span> <span class=\"hljs-keyword\">primary</span> key auto_increment,<br>    paper_name <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">255</span>)<br>);<br><br><span class=\"hljs-keyword\">create</span> <span class=\"hljs-keyword\">table</span> if <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">exists</span> t_review( <span class=\"hljs-comment\">-- 多对多关系的中间表</span><br>    id <span class=\"hljs-type\">bigint</span> <span class=\"hljs-keyword\">primary</span> key auto_increment,<br>    rev_content text,<br>    user_id <span class=\"hljs-type\">bigint</span>,<br>    paper_id <span class=\"hljs-type\">bigint</span><br>)<br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>一个用户能评论多个文章，一个文章能被多个用户评论。</p>\n</blockquote>\n<p>实体类如下设计：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Paper</span> &#123; <span class=\"hljs-comment\">//文章</span><br>    Long id;<br>    String paperName;<br>    List&lt;Review&gt; reviews;<br>    List&lt;User&gt; users;<br>&#125;<br><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span> <br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span> &#123; <span class=\"hljs-comment\">//用户</span><br>    Long id;<br>    String userName;<br>    List&lt;Review&gt; reviews;<br>    List&lt;Paper&gt; papers;<br>&#125;<br><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Review</span> &#123; <span class=\"hljs-comment\">//评论</span><br>    Long id;<br>    Long userId;<br>    Long paperId;<br>    String revContent;<br>&#125;<br><br></code></pre></td></tr></table></figure>\n<h3 id=\"查询用户及其所评论的文章和评论内容\"><a class=\"markdownIt-Anchor\" href=\"#查询用户及其所评论的文章和评论内容\">#</a> 查询用户及其所评论的文章和评论内容</h3>\n<h4 id=\"collection-2\"><a class=\"markdownIt-Anchor\" href=\"#collection-2\">#</a> collection</h4>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resultMap</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;userCollection&quot;</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;User&quot;</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;id&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;u_id&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;userName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;user_name&quot;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">collection</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;papers&quot;</span> <span class=\"hljs-attr\">ofType</span>=<span class=\"hljs-string\">&quot;paper&quot;</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;id&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;p_id&quot;</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;paperName&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;paper_name&quot;</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">collection</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;reviews&quot;</span> <span class=\"hljs-attr\">ofType</span>=<span class=\"hljs-string\">&quot;review&quot;</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">id</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;id&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;id&quot;</span>/&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;paperId&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;paper_id&quot;</span>/&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;revContent&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;rev_content&quot;</span>/&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">result</span> <span class=\"hljs-attr\">property</span>=<span class=\"hljs-string\">&quot;userId&quot;</span> <span class=\"hljs-attr\">column</span>=<span class=\"hljs-string\">&quot;id&quot;</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">collection</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">collection</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resultMap</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getUserReview&quot;</span> <span class=\"hljs-attr\">resultMap</span>=<span class=\"hljs-string\">&quot;userCollection&quot;</span>&gt;</span><br>    select * from t_user join t_review join t_paper on u_id=t_review.user_id and t_review.paper_id = p_id where user_id = #&#123;id&#125;<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"查询文章及其评论的用户的和评论内容\"><a class=\"markdownIt-Anchor\" href=\"#查询文章及其评论的用户的和评论内容\">#</a> 查询文章及其评论的用户的和评论内容</h3>\n<p>以文章表为主表，用户表为从表。其余与<strong>查询用户及其所评论的文章和评论内容</strong>一样。</p>\n<h1 id=\"缓存\"><a class=\"markdownIt-Anchor\" href=\"#缓存\">#</a> 缓存</h1>\n<h2 id=\"一级缓存\"><a class=\"markdownIt-Anchor\" href=\"#一级缓存\">#</a> 一级缓存</h2>\n<p>由 <code>SqlSession</code>  提供，默认设置，不用自主开启。同一个 <code>SqlSession</code>  实例和同一个 <code>sql</code>  语句。就会使用缓存。</p>\n<p>第一次 <code>DQL</code>  和第二次 <code>DQL</code>  之间你做了以下两件事中的任意一件，都会让一级缓存清空:</p>\n<ol>\n<li>执行了 <code>sqlSession的clearCache()</code>  方法，这是手动清空缓存。</li>\n<li>执行了 <code>INSERT</code>  或 <code>DELETE</code>  或 <code>UPDATE</code>  语句。不管你是操作哪张表的，都会清空一级缓存。</li>\n</ol>\n<h2 id=\"二级缓存\"><a class=\"markdownIt-Anchor\" href=\"#二级缓存\">#</a> 二级缓存</h2>\n<p>由 <code>SqlsessionFactory</code>  提供。</p>\n<p>使用二级缓存需要具备以下几个条件:</p>\n<ol>\n<li>\n<p><code>&lt;setting name=&quot;cacheEnabled&quot;value=&quot;true&quot;&gt;</code>  全局性地开启或关闭所有映射器配置文件中已配置的任缓存。默认就是 true, 无需设置</p>\n</li>\n<li>\n<p>在需要使用二级缓存的 <code>SglMapperxml</code>  文件中添加配置:  <code>&lt;cache /&gt;</code></p>\n</li>\n<li>\n<p>使用二级缓存的卖体类对象必须是可序列化的，也就是必须实现 <code>java.io.Serializable</code>  接口</p>\n</li>\n<li>\n<p><code>SqlSession</code>  对象关闭或提交之后，一级缓存中的数据才会被写入到二级缓存当中。此时二级缓存才可用。</p>\n</li>\n</ol>\n<h1 id=\"逆向工程\"><a class=\"markdownIt-Anchor\" href=\"#逆向工程\">#</a> 逆向工程</h1>\n<h1 id=\"pagehelper\"><a class=\"markdownIt-Anchor\" href=\"#pagehelper\">#</a> PageHelper</h1>\n<p>第三方提供的分页插件，依赖如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.github.pagehelper<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>pagehelper<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>x.x.x<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>使用如下，首先前往 <code>Mybatis</code>  的核心配置文件，配置如下内容，注册拦截器：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugins</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span> <span class=\"hljs-attr\">interceptor</span>=<span class=\"hljs-string\">&quot;com.github.pagehelper.PageInterceptor&quot;</span>/&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugins</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>其次编写抽象方法和查询的 <code>sql</code>  语句：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;getCars&quot;</span> <span class=\"hljs-attr\">resultType</span>=<span class=\"hljs-string\">&quot;car&quot;</span>&gt;</span><br>    select * from t_car <span class=\"hljs-comment\">&lt;!--注意此处不要用limit，也不要用分号结尾--&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>然后编写代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">PageHelper.startPage(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">5</span>); <span class=\"hljs-comment\">//开启PageHelper的功能，1为开始的页数，5为本页的数据个数</span><br><span class=\"hljs-type\">SqlSession</span> <span class=\"hljs-variable\">sqlSession</span> <span class=\"hljs-operator\">=</span> SqlSessionUtil.getSqlSession();<br><span class=\"hljs-type\">CarMapper</span> <span class=\"hljs-variable\">carMapper</span> <span class=\"hljs-operator\">=</span> sqlSession.getMapper(CarMapper.class);<br>List&lt;Car&gt; cars = Car.getCars();<br>PageInfo&lt;Car&gt; pageInfo = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PageInfo</span>&lt;&gt;(cars); <span class=\"hljs-comment\">//分页数据就保存在PageInfo对象中，其中PgeInfo的泛型用于声明保存的是何种对象</span><br></code></pre></td></tr></table></figure>\n<h1 id=\"注解式开发\"><a class=\"markdownIt-Anchor\" href=\"#注解式开发\">#</a> 注解式开发</h1>\n<p><code>Mybatis</code>  提供了通过注解的方式开发，但对于复杂的 <code>sql</code>  语句， <code>Mybatis</code>  建议任然用 <code>xml</code>  进行开发，下面介绍简单的用法。</p>\n<h2 id=\"insert\"><a class=\"markdownIt-Anchor\" href=\"#insert\">#</a> @Insert</h2>\n<p><code>insert</code>  语句的注解表示。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Insert(&quot;insert into t_car values(null,#&#123;carNum&#125;,#&#123;brand&#125;,#&#123;guidePrice&#125;,#&#123;produceTime&#125;,#&#123;carType&#125;)&quot;)</span><br><span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">IndsertCar</span><span class=\"hljs-params\">(Car car)</span>;<br></code></pre></td></tr></table></figure>\n<h2 id=\"delete\"><a class=\"markdownIt-Anchor\" href=\"#delete\">#</a> @Delete</h2>\n<p><code>delete</code>  语句的注解表示。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Delete(&quot;delete from t_car where id=#&#123;id&#125;&quot;)</span><br><span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">delCar</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@Param(&quot;id&quot;)</span><span class=\"hljs-type\">int</span> id)</span>;<br></code></pre></td></tr></table></figure>\n<h2 id=\"udate\"><a class=\"markdownIt-Anchor\" href=\"#udate\">#</a> @Udate</h2>\n<p><code>update</code>  语句的注解表示</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Update(&quot;update t_car set car_num=#&#123;carNum&#125;,brand=#&#123;brand&#125;&quot;)</span><br><span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">updateCar</span><span class=\"hljs-params\">(Car car)</span>;<br></code></pre></td></tr></table></figure>\n<h2 id=\"select\"><a class=\"markdownIt-Anchor\" href=\"#select\">#</a> @Select</h2>\n<p><code>select</code>  语句的注解表示</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Select(&quot;select * from t_car where id=#&#123;id&#125;&quot;)</span><br>Car <span class=\"hljs-title function_\">getCar</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@Param(&quot;id&quot;)</span><span class=\"hljs-type\">int</span> id)</span>;<br></code></pre></td></tr></table></figure>\n<h3 id=\"results\"><a class=\"markdownIt-Anchor\" href=\"#results\">#</a> @Results</h3>\n<p>自定义映射。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Select(&quot;select * from t_car where id=#&#123;id&#125;&quot;)</span><br><span class=\"hljs-meta\">@Results(value =&#123;</span><br><span class=\"hljs-meta\">    \t\t@Result(property = &quot;carNum&quot;, column = &quot;car_num&quot;),</span><br><span class=\"hljs-meta\">        \t@Result(property = &quot;guidePrice&quot;, column = &quot;guide_price&quot;)</span><br><span class=\"hljs-meta\">    \t&#125;</span><br><span class=\"hljs-meta\">)</span><br>Car <span class=\"hljs-title function_\">getCar</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@Param(&quot;id&quot;)</span><span class=\"hljs-type\">int</span> id)</span>;<br></code></pre></td></tr></table></figure>\n",
            "tags": [
                "ORM框架",
                "MyBatis"
            ]
        }
    ]
}